# PLIS
## Класификация ПЛИС
### SPLD
SPLD (Simple Programmable Logic Device) простейшие программируемые логические дивайсы разделяются на PLA и PAL
#### PLA
PLA (Programmable Logic Arrays) - программируемые логические матрицы, состоит из матрицы вентелей И и матрицей вентелей ИЛИ. Программируется плавкими перемычками  
#### PAL
PAL (Programmable Array Logic) - программируемые матрицы логики, состоит из программируемой части И матрицы и не программируемой матрицей ИЛИ. Программируется плавкими перемычками
### CPLD
CPLD (Complex Programmable Logic Device) - комплексные программируемые логические устройства
Состоит из:
- ПМЛ подобных блоков
- Программируемой матрицы соединений
- порты ввода - вывода
- Блоки ФАПЧ
### FPGA
FPGA (Field Programmable Gate Arrays) - Программируемые пользователем вентильные матрицы  
Cостоит из:
- LUT (Look-Up Table)
- множество функциональных блоков
- система межсоединений(отличается от CPLD)
- Энергозависимая память конфигурации
## IP блоки
IP-блоки (Intellectual Property blocks) — это готовые, предварительно разработанные и верифицированные модули для ПЛИС (FPGA) и ASIC, которые можно интегрировать в проект для ускорения разработки. Они бывают аппаратными (реализованы в железе) и программными (на HDL-коде).  
Пример:
- Интерфейсы: UART, SPI, I2C, Ethernet, USB
- Память: FIFO, DDR3/4 контроллеры, RAM/ROM
- Арифметика: Целочисленные/FPU ALU, DSP-блоки (умножители, FFT)
разделяют Hard IP и Soft IP
### Hard IP
Аппаратно-зависимый блок, выпускаемый, как правило, под конкретное семейство ПЛИС, ему соответствует ASIC – структура внутри ПЛИС  
Пример:
- АЦП, ЦАП
- PLL
### Soft IP
Аппаратно-независимый блок, использование которого не зависит от конкретной ПЛИС. Применяется для построения составных частей СнК на регулярной структуре  
Пример:
- интерфейсы: UART, SPI, I2C
- FIFO
## LUT
LUT (Look-Up Table, таблица перекодировки) — это базовый элемент комбинационной логики в ПЛИС (FPGA), который реализует произвольную логическую функцию от нескольких входов.  
LUT с N входами хранит $2^N$ бит (все возможные комбинации выходов для входных значений).
## DSP-ячейки 
DSP-ячейки (Digital Signal Processing blocks) — это специализированные аппаратные блоки в ПЛИС (FPGA), предназначенные для эффективного выполнения математических операций: умножения, сложения, умножения с накоплением (MAC) и других задач цифровой обработки сигналов (ЦОС). Они существенно ускоряют вычисления по сравнению с реализацией тех же операций на обычной логике (LUT).
## Типы присваивания 
### Блокирующее присваивание (=)
Выполняется немедленно и блокирует выполнение последующих операций до своего завершения.
```verilog
always @(*) begin
    a = b + c;  // Сначала вычисляется a
    d = a << 1;  // Затем d (используется новое значение a)
end
```
Cинтезируется в комбинационную логику
### Неблокирующее присваивание (<=)
Все присваивания в блоке выполняются параллельно (правые части вычисляются одновременно, а присваивания происходят в конце временного шага).
```verilog
always_ff @(posedge clk) begin
    q1 <= d;   // Все триггеры обновляются одновременно
    q2 <= q1;  // q2 получит значение q1 до обновления
end
```
Синтезируется в D-триггеры (регистры), работающие по фронту тактового сигнала.
## Система межсоединений
![image](https://github.com/user-attachments/assets/30a2c06c-cb93-43ab-a10e-3ccf62c6a457)
- Одинарной длины – соединяют ФБ между собой или горизонтальными линиями, соединяющие переключательные блоки (ПБ)
- Двойной длины – соединяют переключательные блоки через один
- Длинные линии используются для соединения областей кристалла между собой
## ФАПЧ
ФАПЧ(фазовая автоподстройка частоты)
![image](https://github.com/user-attachments/assets/73fb5bfb-de86-4635-8bdf-e04f0ca6d0a0)  
ГУН – генератор частоты, управляемый напряжением  
Делитель 1/M – уменьшает опорную частоту, входная частота делится на M  
Делитель 1/N – уменьшает частоту петли обратной связи, выходная частота умножается на N  
Делитель 1/P – делит выходную частоту на P, опциональный и используется более тонкой настройки выходной частоты  
## Блочная память (Block RAM)
![image](https://github.com/user-attachments/assets/88b000ac-3d04-4da5-81cb-6783d1f697d4)
Распределена по всему кристалу  
Не имеет строгой организации и может быть сконфигурирована под различную разрядность данных в зависимости от задачи  
Как правило имеет двухпортовую организацию (чтение и запись)  
Может иметь внутренние схемы коррекции ошибок и конфигурируемый буфер FIFO  
Объём менее 50 Мбит даже для очень больших ПЛИС
## Блоки ввода/вывода 
![image](https://github.com/user-attachments/assets/e5cbfc37-1f7e-4ed8-9f9e-cba57eaee71c)  
Порты ввода-вывода сгруппированы в блоки дифференциальных пар, но могут работать независимо  
Блок ввода-вывода структурно разделяется на электрическую и логическую части
## JTAG интерфейс
JTAG – Joint Test Action Group – группа инженеров, задачей которых была выработка стандарта для проверки микросхем на работоспособность
![image](https://github.com/user-attachments/assets/f69b994c-fe1f-4c93-b95f-93923fe45282)
- TDI (Test Data In) — вход данных
- TDO (Test Data Out) — выход данных
- TCK (Test Clock) — тактовый сигнал
- TMS (Test Mode Select) — управление режимами
- TRST (Test Reset) — сброс.
### Метод граничного сканирования
Метод граничного сканирования обеспечивает:
- Проверка функциональной работоспособности БИС с помощью встроенных в них тестовых цепей  
- проверка качества соединений между контактами различных БИС, смонтированных на печатной плате
- считывание или установка сигналов на выходных контактах БИС в штатном режиме работы БИС
Метод граничного сканирования реализуется:
- источник тестовых команд и данных (тестовый прибор, который может являться персональным компьютером, специализированным оборудованием, микросхемой на плате, или блоком микросхемы, отвечающий за тестирование)
- механизм информационной связи тестируемых БИС и тестового прибора
- схема управления JTAG –интерфейсом в каждой проверяемой микросхеме
### Режимы работы JTAG
- Режимы самотестирования БИС, режимы записи или чтения внутрисхемных запоминающих устройств и т.д.
- Режим тестирования соединения БИС между собой
- Режим тестирования штатной работы БИС
### Структура Сканирующей ячейки
![image](https://github.com/user-attachments/assets/81e63286-ce5a-4b40-bcec-2978d4b3b6a7)
### Диограмма состояний TAP-контроллера 
![image](https://github.com/user-attachments/assets/791873b2-51cc-417c-b202-50e808846bde)
- Условие перехода между состояниями контролера – это состояние сигнала TMS (0-1)
- DR – data register
- IR – instruction register
### Системные функции JTAG
- Конфигурирование ПЛИС (в том числе загрузка в память и выбор различных конфигураций)
- Встраивание отладочных средств внутрь ПЛИС – средств самотестирования СнК или тестирования других микросхем, входящих в систему
- Внутрисхемная отладка – наблюдение состояния не только внутренних сигналов, но и состояния выводов микросхем (Tools - > Signal Tap)
### Стандарты JTAG
- BSDL — Boundary -Scan Description Language — язык описания организации и архитектуры граничного сканирования в рамках одиночной БИС
- HSDL — Hierarchical Scan Description Language (разработка фирмы Texas Instruments) — язык, ориентированный на описание информационных потоков в группе БИС, объединенных JTAG – интерфейсом - усовершенствованный язык по сравнению с BSDL – облегчает работу с интерфейсами, шинами и системами, состоящими из множества микросхем
- SVF – Serial Vector Format – упрощѐнный способ: подал тестовую последовательность (вектор), считал результат, сравнил с эталоном
### Главное JTAG 
- Необходимость поддержки этого стандарта диктуется возрастающей сложностью микросхем, печатных плат, систем и сетей на их основе
- Стандарт поддерживает гибкость тестирования за счѐт многообразия инструментов
- За время существования стандарт был дополнен различными «надстройками», отвечающими на развитие вычислительных средств, интерфейсов, сетей и т.п.
- Поддержка стандарта не требует значительных ресурсов микросхемы
- Встраивание систем самоконтроля обязательно для систем, применяемых в особо ответственных секторах (оборона, космос, телекоммуникации, медицина и т.п.)
## Системы на кристале СнК
совокупность аппаратных средств, обеспечивающих функции обмена информацией, еѐ обработки, хранения и управления этим процессом, выполненную на одном (программируемом) кристалле.
### Состав СнК
- Микропроцессор(ы)
- Память ОЗУ
- Память ПЗУ программ
- Системная шина (AMBA APB, AHB, AXI, Wishbone, OCP)
- Интерфейсы (UART, I2C, SPI, Ethernet)
- Сопроцессоры (аппаратные блоки) – ЦОС, крипто- и другие
### Система на программируемом кристале
|СБИС|          Характеристика           |ПЛИС|
|----|-----------------------------------|----|
| да |         энергозависимость         | да |
| да |     низкое энергопотребление      | да |
| нет|       перепрограммируемость       | да |
| нет| быстрый цикл разработки устройств | да |
| нет|   низкие затраты на производство  | да |
| нет| отсутствие затран на инж. образцы | да |
### Преймущества
- Уменьшается масса и габаритные размеры устройств за счѐт меньшего количества корпусов микросхем и их «обвязки»
- Увеличивается надѐжность за счѐт меньшего количества паяных соединений и высокой степени автоматизации тестирования и отладки
- Уменьшается стоимость при массовом выпуске
- Снижается энергопотребление
- Увеличивается быстродействие за счѐт уменьшения длин линий передачи данных и логических уровней передаваемых данных
- Появляется возможность поддержки операционных систем, в том числе, и реального времени
### Обобщённая структура микропроцессора
![image](https://github.com/user-attachments/assets/7620462c-e03e-41ac-a618-a3a1f9bb99bd)
- АЛУ
- Умножители и делители (аппаратные)
- Блок операций с «плавающей» запятой (FPU)
- Специализированные вычислители: ЦОС, векторные и другие
### Микропроцессорные ядра
- Являются основой системы на кристалле (системы на программируемом кристалле)
- IP-ядро со средствами отладки
- Крупные производители ПЛИС стараются предоставить разработчику возможность использования МП собственной архитектуры, оптимизированной под выбранное семейство ПЛИС
- Есть встроенные hard-IP блоки в старших семействах ПЛИС, soft-IP для всех семейств ПЛИС
- Стоит вопрос о распределнии задач: программное/аппаратное решение
- Требуется отладка аппаратной и программных частей
# Вопросы к зачёту
## Классификация цифровых интегральных схем, подчеркните положение ПЛИС среди них.
Малая степень интеграции - десятки логических элементов.  
Средняя степень интеграции - сотни элементов.  
Большая степень интеграции - тысячи элементов.  
Сверх большая степень интеграции - миллионы элементов. 
ПЛИС имеет сверх большую интеграцию, она позволяют пользователю самостоятельно конфигурировать структуру схемы после изготовления, в отличие от ASIC, которые фиксированы при производстве.
## История возникновения и особенности программируемых логических микросхем.
Разработчики нуждались в гибкой замене жёстко заданных логических схем, особенно при создании небольших партий цифровых устройств. Появились [SPLD](#spld). Но SPLD это микросхемы малой степени интеграции из-за чего появились [CPLD](#cpld), которые были более производительными и имели большее количество транзисторов(по сути CPLD - это множество SPLD систем на кристале). Переход от CPLD к [FPGA](#fpga) произошёл из-за Лёгкой маштабируемости FPGA, потребность в сложной логике и параллелизме, FPGA имеют гибкую маршрутизацию и позволяют эффективно соединять любые блоки между собой — CPLD ограничены фиксированной архитектурой, появление специальных блогов в FPGA: PLL, RAM, DSP-блоки, Поддержка высокоскоростных интерфейсов.
## Общие (системные) свойства микросхем программируемой логики.
<details>
<summary> Универсальность и связанное с ней массовое производство</summary>
<ul>
<li>ПЛИС — гибкая микросхема общего назначения. На ней можно реализовать что угодно: от простых логических схем до целых процессоров.</li>
<li>Благодаря этой универсальности, одни и те же модели ПЛИС выпускаются массово, независимо от того, где и как будут использоваться.</li>
<li>Производителям выгодно делать типовые чипы, а функциональность определяет уже сам пользователь.</li>
</ul>
</details>
<details>
<summary> Низкая стоимость за счѐт массового производства</summary>
<ul>
<li>Поскольку все ПЛИС одинаковые "в железе", и только программируются по-разному, завод может выпускать огромные партии одного типа.</li>
<li>Это сильно снижает себестоимость: нет необходимости проектировать и изготавливать уникальные микросхемы под каждый проект (в отличие от ASIC).</li>
</ul>
</details>
<details>
<summary> Высокий процент выхода годных микросхем из-за «регулярной» структуры микросхем</summary>
<ul>
<li>Архитектура ПЛИС — регулярная, симметричная, с повторяющимися логическими блоками.</li>
<li>Это облегчает тестирование и снижает вероятность дефектов: если один блок не работает, остальные могут использоваться.</li>
<li>Возможны даже механизмы обхода дефектных участков, что увеличивает выход годных микросхем.</li>
</ul>
</details>
<details>
<summary> Высокое быстродействие и надѐжность за счѐт высокой степени интеграции</summary>
<ul>
<li>ПЛИС содержат сотни тысяч логических элементов на одном кристалле, без необходимости соединять десятки отдельных микросхем.</li>
<li>Отсутствие длинных внешних связей → меньше помех, меньше задержек, выше надёжность.</li>
<li>За счёт аппаратной реализации схем (вместо программной) достигается высокая скорость работы.</li>
</ul>
</details>
<details>
<summary> Разнообразие корпусов микросхем</summary>
<ul>
<li>ПЛИС выпускаются в разных форм-факторах: от компактных QFN до мощных BGA с сотнями выводов.</li>
<li>Это позволяет использовать их в самых разных условиях: от встраиваемых систем до промышленных решений.</li>
</ul>
</details>
<details>
<summary> Разнообразие в выборе напряжения питания выводов микросхемы и доступных физических интерфейсов в микросхемах</summary>
<ul>
<li>Современные ПЛИС поддерживают различные уровни логических сигналов: 1.2В, 1.8В, 2.5В, 3.3В и т.д.</li>
<li>Многие ПЛИС имеют встроенные буферы для популярных интерфейсов: LVTTL, LVCMOS, LVDS, SSTL, и др.</li>
<li>Это упрощает подключение к внешним устройствам без дополнительных компонентов.</li>
</ul>
</details>
<details>
<summary> Сильно развитые САПР</summary>
<ul>
<li>Под ПЛИС существует мощное ПО для проектирования: Xilinx Vivado, Intel Quartus, Lattice Diamond и др.
<li>Включают симуляцию, анализ временных диаграмм, автоматическую маршрутизацию и оптимизацию.</li>
<li>Позволяют работать на уровне как регистровой передачи (RTL), так и блочного проектирования.</li>
</ul>
</details>
<details>
<summary> Относительно низкий «порог входа»</summary>
<ul>
<li>В отличие от ASIC (где нужен заказ на производство, сложное тестирование и высокая стоимость), ПЛИС можно использовать "с порога": купить микросхему, скачать САПР и программировать.</li>
<li>Есть бесплатные версии ПО, открытые IP-ядра, обучающие платы — что делает их доступными даже студентам.</li>
</ul>
</details>
<details>
<summary> Меньшее время проектирования и отладки устройств</summary>
<ul>
<li>В отличие от разработки ASIC или проектирования жёсткой логики из отдельных микросхем, с ПЛИС:</li>
<ul>
<li>всё можно моделировать, отлаживать и менять в САПР,</li>
<li>программировать и тестировать прямо на целевой плате.</li>
</ul>
<li>Весь цикл — от идеи до прототипа — можно пройти за несколько дней или недель, а не месяцев.</li>
</ul>
</details>
<details>
<summary> Простота модификации проекта на любой стадии разработки</summary>
<ul>
<li>Поскольку логика ПЛИС программируется, её можно изменять в любой момент:</li>
<ul>
    <li>внести изменения в схему,</li>
    <li>заменить модуль,</li>
    <li>перепрошить чип — и всё без переделки платы.</li>
</ul>
<li>Это особенно важно на ранних стадиях разработки и при быстром прототипировании.</li>
</ul>
</details>

## Маршрут автоматизированного проектирования системы на основе ПЛИС.
Получение и/или анализ технического задания

<details>
<summary> Создание нового проекта (выбор семействаи типа ПЛИС, а также средств синтеза)</summary>
Критерии:
<ul>
<li>Ёмкость ПЛИС</li>
<li>Наличие САПР на предприятии</li>
<li>Максимальная частота работы</li>
<li>Наличие отладочного стенда</li>
<li>Наличие понятной документации</li>
<li>Поддержка различных напряжений питания</li>
<li>Количество портов ввода-вывода</li>
<li>Стоимость/доступность!</li>
</ul>
</details>

<details>
<summary> Подготовка описания проектируемого устройства в графической и/или текстовой форме</summary>
Критерии:
<ul>
<li>Создание структурной и функциональной схемы проектируемого устройства</li>
<li>Проектирование сложных современных устройств опирается не столько на создание новых модулей с уникальным функционалом, сколько на повторное использование и настройку уже существующих (IP-ядра)</li>
<li>Графическая форма – более наглядное представление структуры проекта – верхний уровень</li>
<li>Текстовые формы – как правило, внутри отдельных модулей</li>
</ul>
</details>

<details>
<summary> Функциональное моделирование</summary>
<ul>
<li>Предназначено для проверки функционала разработанных модулей проекта и всего проекта целиком</li>
<li>Проверка идѐт «снизу – вверх» - сначала проверяются составляющие, затем проект целиком</li>
<li>Для сложных проектов используются тестовые воздействия, написанные на на языках HDL (например, SystemVerilog), в случае поиска неработоспособности – анализ временных диаграмм </li>
<li>Функциональное моделирование не учитывает топологические задержки, температуру окружающей среды, уровень напряжения питания и прочие факторы «реального» мира </li>
<li>Удобно создать файл тестовых воздействий (testbench), который будет использован повторно на следующих этапах автоматизированного проектирования</li>
</ul>
</details>

<details>
<summary> Синтез</summary>
Происходит перевод графического и/или текстового описания проекта в ячейки выбранного семейства ПЛИС без учѐта размещения внутри ПЛИС, но с учѐтом имеющихся в семействе функциональных блоков

![image](https://github.com/user-attachments/assets/0d9e1c54-720e-4316-bb1c-bdfd5ebb0ace)
</details>

<details>
<summary> Верефикация после синтеза</summary>
<ul>
<li>Этот этап нужен для того, чтобы удостовериться, что после синтеза функционал разрабатываемого устройства не был потерян</li>
<li>Можно использовать тот же файл тестовых воздействий, который использовался на этапе функционального моделирования</li>
<li>Если результат неудовлетворительный – возврат на этапы 3-4.</li>
</ul>
</details>

<details>
<summary> Размещение и трассировка проекта на кристале</summary>
<ul>
<li>Каждый кристалл – микросхема ПЛИС характеризуется набором портов ввода/вывода, наличием PLL-блоков (ФАПЧблоков), элементов памяти, встроенными IP и т.д.</li>
<li>Размещение – использование ресурсов ПЛИС для задействования их под синтезированные блоки </li>
<li>Трассировка – обеспечение соединения блоков между собой и портами ввода-вывода</li>
<li>Основные «стратегии»: обеспечение минимальной занимаемой проектом площади кристалла или обеспечение максимальной производительности</li>
<li>Важную роль играют ограничения (constraints) – обеспечение минимальной тактовой частоты работы какого-либо блока, максимальной задержки между какими-либо парами сигналов, необходимость подключения блоков ввода-вода и прочими. См. «критический путь»</li>
<li>Проект виртуально размещается в кристалле, для того, чтобы удостовериться, что ресурсов кристалла (трассировочных, ФБ, IP и т.д.) достаточно, чтобы вместить синтезированный проект и при этом заданные ограничения были выполнены</li>
<li>Возможен возврат на предыдущие этапы проектирования</li>
</ul>
</details>
